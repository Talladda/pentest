#этот код тоже работает, но в нем нет nmap
#import socket
#import sys
#mas = [20, 21, 22, 23, 25, 42, 43, 53, 67, 69, 80, 110, 115, 123, 137, 138, 139, 143, 161, 179, 443, 445, 514, 515, 993, 995, 1080, 1194, 1433, 1702, 1723, 3128, 3268, 3306, 3389, 5432, 5060, 5900, 5938, 8080, 10000, 20000]
#host = input('Введите имя сайта или IP адрес: ') # надо забирать данные из кода Жени
#for port in mas:
    #s = socket.socket()
    #s.settimeout(1)
    #try:
        #s.connect((host, port))
    #except socket.error:
        #pass
    #else:
        #s.close
        #print (host + ': ' + str(port) + ' порт активен')


import nmap

def scan_ip(ip_address):
    """Function take ip and scan ports, os, protocols"""
    nm = nmap.PortScanner()

    nm.scan(ip_address, arguments="-O -sV", sudo=True)

    result = [] 

    for host in nm.all_hosts():
        hostdata = {}
        import pprint
        pp = pprint.PrettyPrinter()
        value_nm = nm[host].get('portused')
        #pp.pprint(value_nm)
        
        hostos = []
        for osclass in nm[host]['osmatch']: #для обнаружения ОС нужны рут-права
            hostos.append(osclass['name']) #request name of os in osclass

        
        hostdata['host_ip'] = host
        hostdata['port_data'] = value_nm
        hostdata['os'] = hostos
        result.append(hostdata)

    return result


def html_ip(scan_results):
    html = """
    <table>
    <tr>
        <th>IP</th>
        <th>Port</th>
        <th>OS</th>
    </tr>"""

    for port_ip in scan_results:
        port_list = ""
        for p in port_ip['port_data']:
            port_list += "<p>{}</p>".format(p)

    for host in scan_results:
        os_list = ""
        for o in host['os']:
            os_list += "<p>{}</p>".format(o)

        html += """<tr>
                <td>{}</td>
                <td>{}</td>
                <td>{}</td>
                </tr>""".format(host['host_ip'], port_list, os_list)
                #</tr>""".format(host['host_ip'], host['port_data'], os_list)

    html += '</table>'
    
    return html


if __name__ == '__main__':
    r = scan_ip('192.168.235.2')
    html = html_ip(r)
    print(html)